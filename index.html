<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepe - Real Discount Rental Offers</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8FRXP7DPWM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8FRXP7DPWM');
    </script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f4f4f9; color: #333; }
        header { background-color: #007bff; color: white; padding: 25px; text-align: center; }
        header h1 { margin: 0; font-size: 1.8em; }
        header p { margin: 5px 0 0; font-size: 1.1em; opacity: 0.9; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        
        /* Search Bar Style (Visual Only) */
        .search-bar { background-color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: center; }
        .search-bar input { padding: 12px; border: 1px solid #ccc; border-radius: 4px; width: 80%; max-width: 500px; font-size: 1em; }

        /* Card Layout */
        .offers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .offer-card { background-color: white; border-radius: 10px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); overflow: hidden; transition: transform 0.2s; }
        .offer-card:hover { transform: translateY(-5px); }
        .offer-card img { width: 100%; height: 220px; object-fit: cover; }
        .card-content { padding: 18px; }
        
        .card-content h3 { margin-top: 0; margin-bottom: 5px; color: #007bff; }
        .card-content p { margin-bottom: 8px; font-size: 0.95em; }

        .price-section { margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .original-price { text-decoration: line-through; color: #999; font-size: 0.9em; }
        .discounted-price { color: #dc3545; /* Highlight Color */ font-size: 1.6em; font-weight: bold; margin: 5px 0 10px; }
        
        .discount-tag { background-color: #ffc107; color: #333; padding: 6px 12px; border-radius: 5px; display: inline-block; margin-bottom: 15px; font-weight: bold; font-size: 0.85em; }
        
        .btn-offer { 
            display: block; 
            width: 100%; 
            padding: 12px; 
            background-color: #28a745; /* Green Action Button */
            color: white; 
            text-align: center; 
            border: none; 
            border-radius: 5px; 
            text-decoration: none; 
            margin-top: 15px; 
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-offer:hover { background-color: #1e7e34; }

        /* Footer */
        .footer-links { text-align: center; margin-top: 40px; padding: 25px 0; border-top: 1px solid #ddd; }
        .footer-links a { margin: 0 20px; text-decoration: none; color: #007bff; font-weight: 500; transition: color 0.2s; }
        .footer-links a:hover { color: #0056b3; }
        
    </style>
</head>
<body>

    <header>
        <h1>Pepe - Real Discount Rental Offers</h1>
        <p>Your source for the best apartment and rental deals in the US.</p>
    </header>

    <div class="container">
        <div class="search-bar">
            <input type="text" placeholder="Search by City (Miami, Orlando, etc.)" disabled>
        </div>
        
        <h2>üî• Fresh Discount Offers!</h2>
        <div class="offers-grid" id="offers-list">
            <p>Loading offers...</p>
        </div>

        <div class="footer-links">
            <a href="o-que-e-deal.html">What is a "Deal"?</a>
            <a href="golpes-e-cuidados.html">Scams and Rental Cautions</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const offersList = document.getElementById('offers-list');

            // 1. TRACKING FUNCTION (GA4)
            function trackClick(offerId, cityName) {
                // Sends an event to GA4
                if (typeof gtag === 'function') {
                   gtag('event', 'offer_click', { // Renamed event for clarity
                     'city_interest': cityName,
                     'offer_id': offerId
                   });
                } else {
                    console.log(`CLICK TRACKED LOCALLY! Offer ID: ${offerId}, City: ${cityName}`);
                }
            }

            // 2. FUNCTION TO CREATE THE CARD
            function createOfferCard(offer) {
                const card = document.createElement('div');
                card.className = 'offer-card';

                const html = `
                    <img src="${offer.foto_url || '/imagens/default.jpg'}" alt="Property photo in ${offer.cidade}">
                    <div class="card-content">
                        <h3>${offer.nome_predio}</h3>
                        <p>üìç ${offer.localizacao}</p>
                        <p class="quartos-banheiros">${offer.quartos_banheiros || 'Details not provided'}</p>
                        
                        <div class="price-section">
                            <p class="original-price">Original: $${offer.valor_original ? offer.valor_original.toFixed(2) : 'N/A'}</p>
                            <p class="discounted-price">DISCOUNT: $${offer.valor_com_desconto ? offer.valor_com_desconto.toFixed(2) : 'N/A'}</p>
                        </div>
                        
                        <div class="discount-tag">${offer.tipo_desconto || 'Special Offer'}</div>
                        
                        <a href="${offer.url_oferta}" target="_blank" class="btn-offer" data-id="${offer.id}" data-city="${offer.cidade}">
                            VIEW OFFER (Tracked)
                        </a>
                    </div>
                `;
                card.innerHTML = html;

                // Adds TRACKING to the click button
                card.querySelector('.btn-offer').addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    const city = e.target.getAttribute('data-city');
                    trackClick(id, city);
                });

                return card;
            }

            // 3. LOAD JSON DATA
            fetch('offers.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error loading offers.json: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(offers => {
                    offersList.innerHTML = ''; // Clears "Loading offers..."
                    
                    const activeOffers = offers.filter(o => o.ativa);
                    
                    if (activeOffers.length === 0) {
                        offersList.innerHTML = '<p>No active offers found at the moment. Add offers to your offers.json!</p>';
                        return;
                    }
                    
                    activeOffers.forEach(offer => {
                        offersList.appendChild(createOfferCard(offer));
                    });
                })
                .catch(error => {
                    console.error('Fatal error loading catalog:', error);
                    offersList.innerHTML = '<p style="color:red; font-size:1.2em;">Oops! Error loading offers. Check the syntax of your offers.json file.</p>';
                });
        });
    </script>

</body>
</html>
